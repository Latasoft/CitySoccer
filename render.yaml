# Render Build Configuration
# This file tells Render how to build and deploy your Next.js app

services:
  - type: web
    name: city-soccer
    env: node
    region: oregon # o usa 'singapore' si prefieres
    plan: standard # $25/mes - 2GB RAM, 1 CPU

    # Build Command - Configurar symlinks y construir
    buildCommand: chmod +x scripts/setup-persistent-storage.sh && scripts/setup-persistent-storage.sh && node scripts/ensure-directories.js && npm run build

    # Start Command
    startCommand: npm run start

    # Node.js Version
    buildFilter:
      paths:
        - "**"

    # Environment Variables
    envVars:
      - key: NODE_ENV
        value: production
      - key: NEXT_PUBLIC_SUPABASE_URL
        sync: false
      - key: NEXT_PUBLIC_SUPABASE_ANON_KEY
        sync: false

    # PERSISTENT DISK - Monta en /var/data (única ruta persistente en Render Standard)
    # El script setup-persistent-storage.sh crea symlinks desde /var/data → /public
    disks:
      - name: citysoccer-uploads
        mountPath: /var/data/uploads
        sizeGB: 3
      - name: citysoccer-content
        mountPath: /var/data/content
        sizeGB: 1

    # Auto-Deploy
    autoDeploy: true

    # Health Check
    healthCheckPath: /
